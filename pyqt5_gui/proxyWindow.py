#!/usr/bin/python
# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'proxyWindow.ui'
#
# Created by: PyQt5 UI code generator 5.12
#
# WARNING! All changes made in this file will be lost!

from PyQt5 import QtCore, QtGui, QtWidgets
import subprocess
SETTINGS_TRAY = 'settings/tray'

class Ui_ProxyWindow(object):

    def setupUi(self, Form):
        Form.setObjectName('Form')
        Form.resize(360, 160)
        self.verticalLayout_2 = QtWidgets.QVBoxLayout(Form)
        self.verticalLayout_2.setObjectName('verticalLayout_2')
        self.verticalLayout = QtWidgets.QVBoxLayout()
        self.verticalLayout.setObjectName('verticalLayout')
        self.proxyCheckBox = QtWidgets.QCheckBox(Form)
        self.proxyCheckBox.setObjectName('proxyCheckBox')

        self.verticalLayout.addWidget(self.proxyCheckBox)
        self.line = QtWidgets.QFrame(Form)
        self.line.setFrameShape(QtWidgets.QFrame.HLine)
        self.line.setFrameShadow(QtWidgets.QFrame.Sunken)
        self.line.setObjectName('line')
        self.verticalLayout.addWidget(self.line)
        self.formLayout = QtWidgets.QFormLayout()
        self.formLayout.setObjectName('formLayout')
        self.iPAdressLabel = QtWidgets.QLabel(Form)
        self.iPAdressLabel.setObjectName('iPAdressLabel')
        self.formLayout.setWidget(0, QtWidgets.QFormLayout.LabelRole,
                                  self.iPAdressLabel)
        self.iPAdressLineEdit = QtWidgets.QLineEdit(Form)
        self.iPAdressLineEdit.setEnabled(True)
        self.iPAdressLineEdit.setReadOnly(True)
        self.iPAdressLineEdit.setObjectName('iPAdressLineEdit')
        self.formLayout.setWidget(0, QtWidgets.QFormLayout.FieldRole,
                                  self.iPAdressLineEdit)
        self.portLabel = QtWidgets.QLabel(Form)
        self.portLabel.setObjectName('portLabel')
        self.formLayout.setWidget(1, QtWidgets.QFormLayout.LabelRole,
                                  self.portLabel)
        self.portLineEdit = QtWidgets.QLineEdit(Form)
        self.portLineEdit.setEnabled(True)
        self.portLineEdit.setReadOnly(True)
        self.portLineEdit.setObjectName('portLineEdit')
        self.formLayout.setWidget(1, QtWidgets.QFormLayout.FieldRole,
                                  self.portLineEdit)
        self.verticalLayout.addLayout(self.formLayout)
        self.verticalLayout_2.addLayout(self.verticalLayout)
        self.horizontalLayout = QtWidgets.QHBoxLayout()
        self.horizontalLayout.setObjectName('horizontalLayout')
        self.proxyCancelButton = QtWidgets.QPushButton(Form)
        self.proxyCancelButton.setObjectName('proxyCancelButton')
        self.horizontalLayout.addWidget(self.proxyCancelButton)
        self.proxySaveButton = QtWidgets.QPushButton(Form)
        self.proxySaveButton.setObjectName('proxySaveButton')
        self.horizontalLayout.addWidget(self.proxySaveButton)
        self.verticalLayout_2.addLayout(self.horizontalLayout)

        settings = QtCore.QSettings()
        check_state = settings.value(SETTINGS_TRAY, False, type=bool)
        self.proxyCheckBox.setChecked(check_state)
        self.proxyState()

        self.proxyCancelButton.clicked.connect(Form.reject)
        #self.proxyCheckBox.stateChanged.connect(self.enableProxyState)
        self.proxyCheckBox.clicked.connect(self.save_check_box_settings)
        self.proxySaveButton.clicked.connect(self.enableProxy)

        self.retranslateUi(Form)
        QtCore.QMetaObject.connectSlotsByName(Form)
        self.form = Form

    def retranslateUi(self, Form):
        _translate = QtCore.QCoreApplication.translate
        Form.setWindowTitle(_translate('Form', 'Proxy'))
        self.proxyCheckBox.setText(_translate('Form', 'Enable proxy'))
        self.iPAdressLabel.setText(_translate('Form', 'IP Address :'))
        self.iPAdressLineEdit.setText(_translate('Form', '10.42.0.178'))
        self.portLabel.setText(_translate('Form', 'Port :'))
        self.portLineEdit.setText(_translate('Form', '3128'))
        self.proxyCancelButton.setText(_translate('Form', 'Cancel'))
        self.proxySaveButton.setText(_translate('Form', 'Save'))

    def proxyState(self):
        if self.proxyCheckBox.isChecked():
            self.iPAdressLineEdit.setEnabled(True)
            self.portLineEdit.setEnabled(True)
        else:
            self.iPAdressLineEdit.setEnabled(False)
            self.portLineEdit.setEnabled(False)

    def enableProxy(self):
        if self.proxyCheckBox.isChecked():
            subprocess.call(['scripts/enable_proxy.sh', '1'])
        else:
            subprocess.call(['scripts/enable_proxy.sh', '0'])
        self.form.reject()

    def save_check_box_settings(self):
        settings = QtCore.QSettings()
        settings.setValue(SETTINGS_TRAY, self.proxyCheckBox.isChecked())
        settings.sync()
        self.proxyState()