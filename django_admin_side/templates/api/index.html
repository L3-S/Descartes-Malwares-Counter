{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load i18n %}
 <br /><br />
<center><h1>{% trans "Utilisation de la RPi"%}</h1></center>
<div class="container">
    <div class="row">
        <center><div class="col-sm-4"><div id="piechart"></div></div></center>
        <center><div class="col-sm-6"><div id="mem_cpu" style="width: 400px; height: 120px;"></div></div></center>

    </div>
</div>

  


<script>
setInterval(function()
{ 
    $.ajax({
      type:"GET",
      url:"/api/mem-cpu/?format=json",
      datatype:"html",
      success:function(data)
      {
        mem_percent = data.mem_percent
        cpu_percent = data.cpu_percent
      }
    });
}, 2000);//t
</script>


 <script type="text/javascript">
// Load google charts
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

// Draw the chart and set the chart values
function drawChart() {
  var data = google.visualization.arrayToDataTable([
  ['Task', 'Hard disk usage'],
  ['Utilis√©', {{used_t}}],
  ['Libre', {{free_t}}]
]);

  // Optional; add a title and set the width and height of the chart
  var options = {'title':'Disque dur', 'width':550, 'height':400};

  // Display the chart inside the <div> element with id="piechart"
  var chart = new google.visualization.PieChart(document.getElementById('piechart'));
  chart.draw(data, options);
}
</script> 



 <script type="text/javascript">
      google.charts.load('current', {'packages':['gauge']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['Memory', 0],
          ['CPU', 0],
        ]);

        var options = {
          width: 400, height: 120,
          redFrom: 90, redTo: 100,
          yellowFrom:75, yellowTo: 90,
          minorTicks: 5
        };

        var chart = new google.visualization.Gauge(document.getElementById('mem_cpu'));

        chart.draw(data, options);

       function updateChart() {
              $.ajax({
                  url: '/api/mem-cpu/?format=json',
                  type: 'GET',
                  error: function() {
                      alert('An error occurred connecting to server. Please check your network');
                  },
                  dataType: 'json',
                  success: function(json) {
                          data.setValue(0, 1, json.mem_percent)
                          data.setValue(1, 1, json.cpu_percent)
                          console.log(data);
                          chart.draw(data, options);
                  }
              });
          setTimeout(updateChart, 2000);
          }
          updateChart();
      }
    </script>

 <script type="text/javascript">
      google.charts.load('current', {'packages':['gauge']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['CPU', 80],
        ]);

        var options = {
          width: 400, height: 120,
          redFrom: 90, redTo: 100,
          yellowFrom:75, yellowTo: 90,
          minorTicks: 5
        };

        var chart = new google.visualization.Gauge(document.getElementById('cpu'));

        chart.draw(data, options);

        setInterval(function() {
          data.setValue(0, 1, 40 + Math.round(60 * Math.random()));
          chart.draw(data, options);
        }, 13000);
        setInterval(function() {
          data.setValue(1, 1, 40 + Math.round(60 * Math.random()));
          chart.draw(data, options);
        }, 5000);
        setInterval(function() {
          data.setValue(2, 1, 60 + Math.round(20 * Math.random()));
          chart.draw(data, options);
        }, 26000);
      }
    </script>



{% endblock %}
